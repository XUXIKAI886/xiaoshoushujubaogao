<!DOCTYPE html>
<html lang="zh-CN" data-theme="light" id="htmlRoot">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠŸèƒ½æµ‹è¯•é¡µé¢</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.14/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
</head>
<body class="bg-base-200 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h1 class="card-title text-2xl mb-6">ğŸ§ª åŠŸèƒ½æµ‹è¯•é¡µé¢</h1>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <!-- å·¥å…·å‡½æ•°æµ‹è¯• -->
                    <div class="card bg-base-200">
                        <div class="card-body">
                            <h2 class="card-title">å·¥å…·å‡½æ•°æµ‹è¯•</h2>
                            <div class="space-y-2">
                                <button class="btn btn-sm btn-primary" onclick="testToast()">æµ‹è¯•æç¤ºæ¶ˆæ¯</button>
                                <button class="btn btn-sm btn-secondary" onclick="testValidation()">æµ‹è¯•æ•°æ®éªŒè¯</button>
                                <button class="btn btn-sm btn-accent" onclick="testStorage()">æµ‹è¯•æœ¬åœ°å­˜å‚¨</button>
                                <button class="btn btn-sm btn-outline" onclick="toggleTestTheme()">åˆ‡æ¢ä¸»é¢˜</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å›¾è¡¨æµ‹è¯• -->
                    <div class="card bg-base-200">
                        <div class="card-body">
                            <h2 class="card-title">å›¾è¡¨åŠŸèƒ½æµ‹è¯•</h2>
                            <div class="space-y-2">
                                <button class="btn btn-sm btn-primary" onclick="testBarChart()">æŸ±çŠ¶å›¾</button>
                                <button class="btn btn-sm btn-secondary" onclick="testLineChart()">æŠ˜çº¿å›¾</button>
                                <button class="btn btn-sm btn-accent" onclick="testPieChart()">é¥¼å›¾</button>
                                <button class="btn btn-sm btn-info" onclick="testRadarChart()">é›·è¾¾å›¾</button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- APIæµ‹è¯• -->
                    <div class="card bg-base-200">
                        <div class="card-body">
                            <h2 class="card-title">APIåŠŸèƒ½æµ‹è¯•</h2>
                            <div class="space-y-2">
                                <button class="btn btn-sm btn-primary" onclick="testAPIConnection()">æµ‹è¯•è¿æ¥</button>
                                <button class="btn btn-sm btn-secondary" onclick="testDemoData()">æ¼”ç¤ºæ•°æ®</button>
                                <button class="btn btn-sm btn-accent" onclick="testReportGeneration()">ç”ŸæˆæŠ¥å‘Š</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- æµ‹è¯•ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
                <div class="mt-8">
                    <h2 class="text-xl font-bold mb-4">æµ‹è¯•ç»“æœ</h2>
                    <div id="testResults" class="bg-base-300 rounded-lg p-4 min-h-32">
                        <p class="text-gray-500">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...</p>
                    </div>
                </div>
                
                <!-- å›¾è¡¨æ˜¾ç¤ºåŒºåŸŸ -->
                <div class="mt-8">
                    <h2 class="text-xl font-bold mb-4">å›¾è¡¨æµ‹è¯•åŒºåŸŸ</h2>
                    <div id="testChart" style="width: 100%; height: 400px; background: #f5f5f5; border-radius: 8px;"></div>
                </div>
                
                <!-- æŠ¥å‘Šæµ‹è¯•åŒºåŸŸ -->
                <div class="mt-8">
                    <h2 class="text-xl font-bold mb-4">æŠ¥å‘Šæµ‹è¯•åŒºåŸŸ</h2>
                    <div id="testReport" class="bg-white rounded-lg p-4 min-h-32 border">
                        <p class="text-gray-500">æŠ¥å‘Šå†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥æ‰€æœ‰JavaScriptæ–‡ä»¶ -->
    <script src="js/utils.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/api.js"></script>
    <script src="js/chart.js"></script>
    <script src="js/report.js"></script>
    <script src="js/demo-data.js"></script>

    <script>
        // æµ‹è¯•å‡½æ•°
        function logResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString();
            const colorClass = {
                'success': 'text-green-600',
                'error': 'text-red-600',
                'warning': 'text-yellow-600',
                'info': 'text-blue-600'
            }[type] || 'text-gray-600';
            
            resultsDiv.innerHTML += `<div class="${colorClass}">[${timestamp}] ${message}</div>`;
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        // å·¥å…·å‡½æ•°æµ‹è¯•
        function testToast() {
            showToast('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ¶ˆæ¯', 'success');
            logResult('âœ… Toastæ¶ˆæ¯æµ‹è¯•å®Œæˆ', 'success');
        }

        function testValidation() {
            const testEmail = 'test@example.com';
            const testPhone = '13800138000';
            const isEmailValid = Validator.isEmail(testEmail);
            const isPhoneValid = Validator.isPhone(testPhone);
            
            logResult(`ğŸ“§ é‚®ç®±éªŒè¯ (${testEmail}): ${isEmailValid ? 'âœ… æœ‰æ•ˆ' : 'âŒ æ— æ•ˆ'}`, isEmailValid ? 'success' : 'error');
            logResult(`ğŸ“± æ‰‹æœºéªŒè¯ (${testPhone}): ${isPhoneValid ? 'âœ… æœ‰æ•ˆ' : 'âŒ æ— æ•ˆ'}`, isPhoneValid ? 'success' : 'error');
        }

        function testStorage() {
            const testData = { name: 'æµ‹è¯•æ•°æ®', timestamp: new Date().toISOString() };
            Storage.set('testKey', testData);
            const retrieved = Storage.get('testKey');
            
            const success = JSON.stringify(testData) === JSON.stringify(retrieved);
            logResult(`ğŸ’¾ æœ¬åœ°å­˜å‚¨æµ‹è¯•: ${success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}`, success ? 'success' : 'error');
        }

        // å›¾è¡¨æµ‹è¯•
        function testBarChart() {
            const chartData = {
                type: 'bar',
                title: 'æµ‹è¯•æŸ±çŠ¶å›¾',
                data: {
                    categories: ['äº§å“A', 'äº§å“B', 'äº§å“C', 'äº§å“D'],
                    values: [120, 200, 150, 80],
                    unit: 'ä»¶'
                }
            };
            
            chartGenerator.generateChart('testChart', chartData);
            logResult('ğŸ“Š æŸ±çŠ¶å›¾ç”Ÿæˆå®Œæˆ', 'success');
        }

        function testLineChart() {
            const chartData = {
                type: 'line',
                title: 'æµ‹è¯•æŠ˜çº¿å›¾',
                data: {
                    dates: ['1æœˆ', '2æœˆ', '3æœˆ', '4æœˆ', '5æœˆ'],
                    values: [100, 120, 140, 110, 160],
                    unit: 'å•'
                }
            };
            
            chartGenerator.generateChart('testChart', chartData);
            logResult('ğŸ“ˆ æŠ˜çº¿å›¾ç”Ÿæˆå®Œæˆ', 'success');
        }

        function testPieChart() {
            const chartData = {
                type: 'pie',
                title: 'æµ‹è¯•é¥¼å›¾',
                data: {
                    items: [
                        { name: 'ç±»åˆ«A', value: 35 },
                        { name: 'ç±»åˆ«B', value: 25 },
                        { name: 'ç±»åˆ«C', value: 20 },
                        { name: 'ç±»åˆ«D', value: 20 }
                    ]
                }
            };
            
            chartGenerator.generateChart('testChart', chartData);
            logResult('ğŸ¥§ é¥¼å›¾ç”Ÿæˆå®Œæˆ', 'success');
        }

        function testRadarChart() {
            const chartData = {
                type: 'radar',
                title: 'æµ‹è¯•é›·è¾¾å›¾',
                data: {
                    indicators: [
                        { name: 'æŒ‡æ ‡1', max: 100 },
                        { name: 'æŒ‡æ ‡2', max: 100 },
                        { name: 'æŒ‡æ ‡3', max: 100 },
                        { name: 'æŒ‡æ ‡4', max: 100 },
                        { name: 'æŒ‡æ ‡5', max: 100 }
                    ],
                    values: [80, 90, 70, 85, 75]
                }
            };
            
            chartGenerator.generateChart('testChart', chartData);
            logResult('ğŸ¯ é›·è¾¾å›¾ç”Ÿæˆå®Œæˆ', 'success');
        }

        // APIæµ‹è¯•
        async function testAPIConnection() {
            try {
                logResult('ğŸ”„ æ­£åœ¨æµ‹è¯•APIè¿æ¥...', 'info');
                const isConnected = await geminiAPI.testConnection();
                logResult(`ğŸŒ APIè¿æ¥æµ‹è¯•: ${isConnected ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}`, isConnected ? 'success' : 'error');
            } catch (error) {
                logResult(`âŒ APIè¿æ¥æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function testDemoData() {
            enableDemoMode();
            logResult('ğŸ­ æ¼”ç¤ºæ¨¡å¼å·²å¯ç”¨', 'success');
            logResult('ğŸ“Š æ¼”ç¤ºæ•°æ®å·²åŠ è½½', 'info');
        }

        function testReportGeneration() {
            const reportContainer = document.getElementById('testReport');
            
            // åˆ›å»ºä¸€ä¸ªç®€åŒ–çš„æŠ¥å‘Šç”Ÿæˆå™¨å®ä¾‹
            const testReportGenerator = new ReportGenerator();
            
            // ç”ŸæˆæŠ¥å‘ŠHTML
            const reportHTML = `
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg p-4 mb-4">
                    <h3 class="text-lg font-bold">æµ‹è¯•æŠ¥å‘Š</h3>
                    <p class="text-sm opacity-90">è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç”Ÿæˆçš„æŠ¥å‘Š</p>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-green-50 p-3 rounded border-l-4 border-green-500">
                        <h4 class="font-semibold text-green-800">ä¼˜åŠ¿</h4>
                        <p class="text-sm text-green-700">æµ‹è¯•ä¼˜åŠ¿é¡¹ç›®</p>
                    </div>
                    <div class="bg-red-50 p-3 rounded border-l-4 border-red-500">
                        <h4 class="font-semibold text-red-800">åŠ£åŠ¿</h4>
                        <p class="text-sm text-red-700">æµ‹è¯•åŠ£åŠ¿é¡¹ç›®</p>
                    </div>
                </div>
            `;
            
            reportContainer.innerHTML = reportHTML;
            logResult('ğŸ“‹ æµ‹è¯•æŠ¥å‘Šç”Ÿæˆå®Œæˆ', 'success');
        }

        // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        function toggleTestTheme() {
            if (typeof themeManager !== 'undefined') {
                themeManager.toggleTheme();
                logResult('ğŸ¨ ä¸»é¢˜å·²åˆ‡æ¢', 'info');
            } else {
                // ç®€å•çš„ä¸»é¢˜åˆ‡æ¢
                const htmlRoot = document.getElementById('htmlRoot');
                const currentTheme = htmlRoot.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                htmlRoot.setAttribute('data-theme', newTheme);
                logResult(`ğŸ¨ ä¸»é¢˜å·²åˆ‡æ¢è‡³: ${newTheme}`, 'info');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            logResult('ğŸš€ æµ‹è¯•é¡µé¢å·²åŠ è½½å®Œæˆ', 'success');
            logResult('ğŸ’¡ ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•å„é¡¹åŠŸèƒ½', 'info');
            updateChartCount(0);
        });
    </script>
</body>
</html>
