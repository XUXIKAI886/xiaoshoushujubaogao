<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIé…ç½®æ£€æŸ¥å·¥å…· - ç¾å›¢å¤–å–æ•°æ®åˆ†æ</title>
    
    <!-- Tailwind CSS + DaisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.14/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-base-200 min-h-screen">
    <!-- å¯¼èˆªæ  -->
    <div class="navbar bg-base-100 shadow-lg">
        <div class="flex-1">
            <a class="btn btn-ghost text-xl">ğŸ”§ APIé…ç½®æ£€æŸ¥å·¥å…·</a>
        </div>
        <div class="flex-none">
            <a href="index.html" class="btn btn-outline btn-sm mr-2">è¿”å›ä¸»é¡µ</a>
            <a href="funnel-test.html" class="btn btn-primary btn-sm">è½¬åŒ–æ¼æ–—æµ‹è¯•</a>
        </div>
    </div>

    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="container mx-auto px-4 py-8 max-w-4xl">
        
        <!-- APIé…ç½®çŠ¶æ€ -->
        <div class="card bg-base-100 shadow-xl mb-8">
            <div class="card-body">
                <h2 class="card-title text-2xl mb-4">ğŸ“Š å½“å‰APIé…ç½®</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">APIåŸºç¡€URL</span>
                        </label>
                        <input type="text" id="apiBaseUrl" class="input input-bordered" readonly>
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">AIæ¨¡å‹</span>
                        </label>
                        <input type="text" id="apiModel" class="input input-bordered" readonly>
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">APIå¯†é’¥</span>
                        </label>
                        <input type="text" id="apiKey" class="input input-bordered" readonly>
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text font-semibold">è¿æ¥çŠ¶æ€</span>
                        </label>
                        <div class="flex items-center space-x-2">
                            <span id="connectionStatus" class="badge badge-warning">æœªæµ‹è¯•</span>
                            <button class="btn btn-sm btn-primary" onclick="testConnection()">æµ‹è¯•è¿æ¥</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ç½‘ç»œè¯Šæ–­ -->
        <div class="card bg-base-100 shadow-xl mb-8">
            <div class="card-body">
                <h2 class="card-title text-xl mb-4">ğŸŒ ç½‘ç»œè¯Šæ–­</h2>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span>åŸºç¡€ç½‘ç»œè¿æ¥</span>
                        <span id="networkStatus" class="badge badge-warning">æœªæµ‹è¯•</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>DNSè§£æ</span>
                        <span id="dnsStatus" class="badge badge-warning">æœªæµ‹è¯•</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>HTTPSè¿æ¥</span>
                        <span id="httpsStatus" class="badge badge-warning">æœªæµ‹è¯•</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span>CORSè·¨åŸŸ</span>
                        <span id="corsStatus" class="badge badge-warning">æœªæµ‹è¯•</span>
                    </div>
                    <button class="btn btn-outline w-full" onclick="runNetworkDiagnostics()">
                        å¼€å§‹ç½‘ç»œè¯Šæ–­
                    </button>
                </div>
            </div>
        </div>

        <!-- è§£å†³æ–¹æ¡ˆ -->
        <div class="card bg-base-100 shadow-xl mb-8">
            <div class="card-body">
                <h2 class="card-title text-xl mb-4">ğŸ’¡ å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ</h2>
                
                <div class="collapse collapse-arrow bg-base-200 mb-2">
                    <input type="radio" name="solutions" />
                    <div class="collapse-title text-lg font-medium">
                        ğŸ”‘ APIå¯†é’¥é—®é¢˜
                    </div>
                    <div class="collapse-content">
                        <div class="space-y-2 text-sm">
                            <p><strong>é—®é¢˜</strong>ï¼šAPIå¯†é’¥æ— æ•ˆæˆ–è¿‡æœŸ</p>
                            <p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
                            <ul class="list-disc list-inside ml-4">
                                <li>æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®é…ç½®</li>
                                <li>ç¡®è®¤å¯†é’¥æ˜¯å¦æœ‰æ•ˆä¸”æœªè¿‡æœŸ</li>
                                <li>è”ç³»APIæœåŠ¡æä¾›å•†è·å–æ–°å¯†é’¥</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="collapse collapse-arrow bg-base-200 mb-2">
                    <input type="radio" name="solutions" />
                    <div class="collapse-title text-lg font-medium">
                        ğŸŒ ç½‘ç»œè¿æ¥é—®é¢˜
                    </div>
                    <div class="collapse-content">
                        <div class="space-y-2 text-sm">
                            <p><strong>é—®é¢˜</strong>ï¼šæ— æ³•è¿æ¥åˆ°APIæœåŠ¡å™¨</p>
                            <p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
                            <ul class="list-disc list-inside ml-4">
                                <li>æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸</li>
                                <li>å°è¯•å…³é—­é˜²ç«å¢™æˆ–VPN</li>
                                <li>æ£€æŸ¥ä»£ç†è®¾ç½®</li>
                                <li>å°è¯•ä½¿ç”¨ç§»åŠ¨ç½‘ç»œ</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="collapse collapse-arrow bg-base-200 mb-2">
                    <input type="radio" name="solutions" />
                    <div class="collapse-title text-lg font-medium">
                        ğŸš« CORSè·¨åŸŸé—®é¢˜
                    </div>
                    <div class="collapse-content">
                        <div class="space-y-2 text-sm">
                            <p><strong>é—®é¢˜</strong>ï¼šæµè§ˆå™¨é˜»æ­¢è·¨åŸŸè¯·æ±‚</p>
                            <p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p>
                            <ul class="list-disc list-inside ml-4">
                                <li>ä½¿ç”¨æœ¬åœ°æœåŠ¡å™¨è¿è¡Œé¡¹ç›®</li>
                                <li>é…ç½®æµè§ˆå™¨å…è®¸è·¨åŸŸï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰</li>
                                <li>ä½¿ç”¨ä»£ç†æœåŠ¡å™¨</li>
                                <li>éƒ¨ç½²åˆ°æ”¯æŒCORSçš„æœåŠ¡å™¨</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="collapse collapse-arrow bg-base-200">
                    <input type="radio" name="solutions" />
                    <div class="collapse-title text-lg font-medium">
                        ğŸ­ ä½¿ç”¨æ¼”ç¤ºæ¨¡å¼
                    </div>
                    <div class="collapse-content">
                        <div class="space-y-2 text-sm">
                            <p><strong>ä¸´æ—¶è§£å†³æ–¹æ¡ˆ</strong>ï¼šä½¿ç”¨æ¼”ç¤ºæ•°æ®ä½“éªŒåŠŸèƒ½</p>
                            <p><strong>æ“ä½œæ­¥éª¤</strong>ï¼š</p>
                            <ul class="list-disc list-inside ml-4">
                                <li>åœ¨è½¬åŒ–æ¼æ–—æµ‹è¯•é¡µé¢å…³é—­"çœŸå®AIåˆ†æ"å¼€å…³</li>
                                <li>ç‚¹å‡»"æŸ¥çœ‹æ¼”ç¤ºç»“æœ"æŒ‰é’®</li>
                                <li>ä½“éªŒå®Œæ•´çš„åˆ†ææŠ¥å‘ŠåŠŸèƒ½</li>
                                <li>ç­‰å¾…ç½‘ç»œé—®é¢˜è§£å†³åå†ä½¿ç”¨çœŸå®åˆ†æ</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æµ‹è¯•ç»“æœ -->
        <div class="card bg-base-100 shadow-xl" id="testResults" style="display: none;">
            <div class="card-body">
                <h2 class="card-title text-xl mb-4">ğŸ“‹ æµ‹è¯•ç»“æœ</h2>
                <div id="testResultsContent">
                    <!-- æµ‹è¯•ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/api.js"></script>
    
    <script>
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå½“å‰é…ç½®
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrentConfig();
        });

        function loadCurrentConfig() {
            if (typeof API_CONFIG !== 'undefined') {
                document.getElementById('apiBaseUrl').value = API_CONFIG.baseUrl;
                document.getElementById('apiModel').value = API_CONFIG.model;
                document.getElementById('apiKey').value = API_CONFIG.apiKey ? 
                    API_CONFIG.apiKey.substring(0, 10) + '...' : 'æœªé…ç½®';
            }
        }

        async function testConnection() {
            const statusElement = document.getElementById('connectionStatus');
            statusElement.textContent = 'æµ‹è¯•ä¸­...';
            statusElement.className = 'badge badge-warning';

            try {
                const api = new GeminiAPI();
                const result = await api.testConnection();

                if (result.success) {
                    statusElement.textContent = 'è¿æ¥æˆåŠŸ';
                    statusElement.className = 'badge badge-success';
                } else {
                    statusElement.textContent = 'è¿æ¥å¤±è´¥';
                    statusElement.className = 'badge badge-error';
                }

                // æ˜¾ç¤ºè¯¦ç»†æµ‹è¯•ç»“æœ
                showTestResults(result);

            } catch (error) {
                statusElement.textContent = 'æµ‹è¯•å‡ºé”™';
                statusElement.className = 'badge badge-error';
                console.error('è¿æ¥æµ‹è¯•å‡ºé”™:', error);
            }
        }

        async function runNetworkDiagnostics() {
            // é‡ç½®çŠ¶æ€
            const statuses = ['networkStatus', 'dnsStatus', 'httpsStatus', 'corsStatus'];
            statuses.forEach(id => {
                const element = document.getElementById(id);
                element.textContent = 'æµ‹è¯•ä¸­...';
                element.className = 'badge badge-warning';
            });

            // åŸºç¡€ç½‘ç»œè¿æ¥æµ‹è¯•
            try {
                const response = await fetch('https://www.google.com/favicon.ico', { mode: 'no-cors' });
                document.getElementById('networkStatus').textContent = 'æ­£å¸¸';
                document.getElementById('networkStatus').className = 'badge badge-success';
            } catch (error) {
                document.getElementById('networkStatus').textContent = 'å¼‚å¸¸';
                document.getElementById('networkStatus').className = 'badge badge-error';
            }

            // DNSè§£ææµ‹è¯•
            try {
                const start = Date.now();
                await fetch('https://haxiaiplus.cn', { mode: 'no-cors' });
                const time = Date.now() - start;
                document.getElementById('dnsStatus').textContent = `æ­£å¸¸ (${time}ms)`;
                document.getElementById('dnsStatus').className = 'badge badge-success';
            } catch (error) {
                document.getElementById('dnsStatus').textContent = 'å¤±è´¥';
                document.getElementById('dnsStatus').className = 'badge badge-error';
            }

            // HTTPSè¿æ¥æµ‹è¯•
            try {
                const response = await fetch('https://haxiaiplus.cn', { mode: 'no-cors' });
                document.getElementById('httpsStatus').textContent = 'æ”¯æŒ';
                document.getElementById('httpsStatus').className = 'badge badge-success';
            } catch (error) {
                document.getElementById('httpsStatus').textContent = 'ä¸æ”¯æŒ';
                document.getElementById('httpsStatus').className = 'badge badge-error';
            }

            // CORSæµ‹è¯•
            try {
                const response = await fetch('https://haxiaiplus.cn/v1beta/models');
                document.getElementById('corsStatus').textContent = 'å…è®¸';
                document.getElementById('corsStatus').className = 'badge badge-success';
            } catch (error) {
                if (error.message.includes('CORS')) {
                    document.getElementById('corsStatus').textContent = 'é˜»æ­¢';
                    document.getElementById('corsStatus').className = 'badge badge-error';
                } else {
                    document.getElementById('corsStatus').textContent = 'æœªçŸ¥';
                    document.getElementById('corsStatus').className = 'badge badge-warning';
                }
            }
        }

        function showTestResults(result) {
            const resultsDiv = document.getElementById('testResults');
            const contentDiv = document.getElementById('testResultsContent');

            let html = '<div class="space-y-4">';
            
            // åŸºæœ¬ç»“æœ
            html += `<div class="alert ${result.success ? 'alert-success' : 'alert-error'}">`;
            html += `<span>${result.success ? 'âœ… è¿æ¥æˆåŠŸ' : 'âŒ è¿æ¥å¤±è´¥'}</span>`;
            html += '</div>';

            // é”™è¯¯ä¿¡æ¯
            if (result.error) {
                html += `<div class="bg-base-200 p-4 rounded">`;
                html += `<h4 class="font-semibold mb-2">é”™è¯¯ä¿¡æ¯ï¼š</h4>`;
                html += `<p class="text-sm">${result.error}</p>`;
                html += '</div>';
            }

            // è¯¦ç»†ä¿¡æ¯
            if (result.details && Object.keys(result.details).length > 0) {
                html += `<div class="bg-base-200 p-4 rounded">`;
                html += `<h4 class="font-semibold mb-2">è¯¦ç»†ä¿¡æ¯ï¼š</h4>`;
                html += `<pre class="text-xs overflow-auto">${JSON.stringify(result.details, null, 2)}</pre>`;
                html += '</div>';
            }

            // å»ºè®®
            if (result.suggestions && result.suggestions.length > 0) {
                html += `<div class="bg-base-200 p-4 rounded">`;
                html += `<h4 class="font-semibold mb-2">è§£å†³å»ºè®®ï¼š</h4>`;
                html += '<ul class="list-disc list-inside space-y-1 text-sm">';
                result.suggestions.forEach(suggestion => {
                    html += `<li>${suggestion}</li>`;
                });
                html += '</ul>';
                html += '</div>';
            }

            html += '</div>';
            contentDiv.innerHTML = html;
            resultsDiv.style.display = 'block';
        }
    </script>
</body>
</html>
